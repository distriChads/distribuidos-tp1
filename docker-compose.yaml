name: tp1
networks:
  movies_net:
    ipam:
      config:
        - subnet: 172.25.125.0/24
      driver: default
services:
  client-handler:
    build:
      context: .
      dockerfile: client-handler/Dockerfile
    container_name: client-handler
    depends_on:
      - rabbitmq
    entrypoint: python main.py
    environment:
      - CLIENT_HANDLER_PORT=3000
      - LOGGING_LEVEL=debug
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_WORKER_EXCHANGE1_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE2_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE3_OUTPUT_NAME=data_exchange
      - CLIENT_HANDLER_FILTER_SPAIN_2000_REPLICAS=2
      - CLIENT_HANDLER_LISTEN_BACKLOG=5
      - CLI_WORKER_EXCHANGE1_OUTPUT_ROUTINGKEYS=movies.input1,movies.input2,movies.input3
      - CLI_WORKER_EXCHANGE2_OUTPUT_ROUTINGKEYS=credits.input1,credits.input2,credits.input3
      - CLI_WORKER_EXCHANGE3_OUTPUT_ROUTINGKEYS=ratings.input1,ratings.input2,ratings.input3
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=*.results
    image: client-handler:latest
    networks:
      - movies_net
    ports:
      - 3000:3000
  hasher:
    build:
      context: .
      dockerfile: hasher/Dockerfile
    container_name: hasher
    depends_on:
      - rabbitmq
    entrypoint: python main.py
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=info
      - CLI_WORKER_EXCHANGE_INPUT_NAME=router_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies_filtered,credits,ratings
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=join_exchange
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=join.movies.input
      - CLI_WORKER_QUEUE_NAME=hasher
      - CLI_WORKER_EXPECTEDEOF=3
    image: hasher:latest
    networks:
      - movies_net
  filter-after-2000-1:
    build: &id001
      context: .
      dockerfile: filters/filter_after_2000/Dockerfile
    container_name: filter-after-2000-1
    depends_on: &id002
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=info
      - CLI_WORKER_EXCHANGE_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.argentina.output
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=join.movies.input
    image: filter_after_2000:latest
    networks: &id003
      - movies_net
  filter-after-2000-2:
    build: *id001
    container_name: filter-after-2000-2
    depends_on: *id002
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.argentina.output
      - CLI_WORKER_QUEUE_NAME=filter-after-2000
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=join.movies.input
    image: filter_after_2000:latest
    networks: *id003
  filter-after-2000-3:
    build: *id001
    container_name: filter-after-2000-3
    depends_on: *id002
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.argentina.output
      - CLI_WORKER_QUEUE_NAME=filter-after-2000
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=join.movies.input
    image: filter_after_2000:latest
    networks: *id003
  filter-argentina-1:
    build: &id004
      context: .
      dockerfile: filters/filter_argentina/Dockerfile
    container_name: filter-argentina-1
    depends_on: &id005
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.input1,movies.input2,movies.input3
      - CLI_WORKER_QUEUE_NAME=filter-argentina
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=movies.argentina.output
    image: filter_argentina:latest
    networks: &id006
      - movies_net
  filter-argentina-2:
    build: *id004
    container_name: filter-argentina-2
    depends_on: *id005
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.input1,movies.input2,movies.input3
      - CLI_WORKER_QUEUE_NAME=filter-argentina
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=movies.argentina.output
    image: filter_argentina:latest
    networks: *id006
  filter-argentina-3:
    build: *id004
    container_name: filter-argentina-3
    depends_on: *id005
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.input1,movies.input2,movies.input3
      - CLI_WORKER_QUEUE_NAME=filter-argentina
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=movies.argentina.output
    image: filter_argentina:latest
    networks: *id006
  filter-only-one-country-1:
    build: &id007
      context: .
      dockerfile: filters/filter_only_one_country/Dockerfile
    container_name: filter-only-one-country-1
    depends_on: &id008
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.input1,movies.input2,movies.input3
      - CLI_WORKER_QUEUE_NAME=filter-only-one-country
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=movies.groupby.country-sum.input
    image: filter_only_one_country:latest
    networks: &id009
      - movies_net
  filter-only-one-country-2:
    build: *id007
    container_name: filter-only-one-country-2
    depends_on: *id008
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.input1,movies.input2,movies.input3
      - CLI_WORKER_QUEUE_NAME=filter-only-one-country
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=movies.groupby.country-sum.input
    image: filter_only_one_country:latest
    networks: *id009
  filter-only-one-country-3:
    build: *id007
    container_name: filter-only-one-country-3
    depends_on: *id008
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.input1,movies.input2,movies.input3
      - CLI_WORKER_QUEUE_NAME=filter-only-one-country
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=movies.groupby.country-sum.input
    image: filter_only_one_country:latest
    networks: *id009
  filter-spain-2000-1:
    build: &id010
      context: .
      dockerfile: filters/filter_spain_2000/Dockerfile
    container_name: filter-spain-2000-1
    depends_on: &id011
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.argentina.output
      - CLI_WORKER_QUEUE_NAME=filter-spain-2000
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=query1.results
    image: filter_spain_2000:latest
    networks: &id012
      - movies_net
  filter-spain-2000-2:
    build: *id010
    container_name: filter-spain-2000-2
    depends_on: *id011
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.argentina.output
      - CLI_WORKER_QUEUE_NAME=filter-spain-2000
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=query1.results
    image: filter_spain_2000:latest
    networks: *id012
  filter-spain-2000-3:
    build: *id010
    container_name: filter-spain-2000-3
    depends_on: *id011
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.argentina.output
      - CLI_WORKER_QUEUE_NAME=filter-spain-2000
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=query1.results
    image: filter_spain_2000:latest
    networks: *id012
  first-and-last-1:
    build:
      context: .
      dockerfile: topn/first_and_last/Dockerfile
    container_name: first-and-last-1
    depends_on:
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=topn.first-last.input
      - CLI_WORKER_QUEUE_NAME=first-and-last
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=query3.results
    image: first_and_last:latest
    networks:
      - movies_net
  group-by-actor-count-1:
    build: &id013
      context: .
      dockerfile: group_by/group_by_actor_count/Dockerfile
    container_name: group-by-actor-count-1
    depends_on: &id014
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.actor.input
      - CLI_WORKER_QUEUE_NAME=group-by-actor-count
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.actor.output
    image: group_by_actor_count:latest
    networks: &id015
      - movies_net
  group-by-actor-count-2:
    build: *id013
    container_name: group-by-actor-count-2
    depends_on: *id014
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.actor.input
      - CLI_WORKER_QUEUE_NAME=group-by-actor-count
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.actor.output
    image: group_by_actor_count:latest
    networks: *id015
  group-by-actor-count-3:
    build: *id013
    container_name: group-by-actor-count-3
    depends_on: *id014
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.actor.input
      - CLI_WORKER_QUEUE_NAME=group-by-actor-count
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.actor.output
    image: group_by_actor_count:latest
    networks: *id015
  group-by-country-sum-1:
    build: &id016
      context: .
      dockerfile: group_by/group_by_country_sum/Dockerfile
    container_name: group-by-country-sum-1
    depends_on: &id017
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.groupby.country-sum.input
      - CLI_WORKER_QUEUE_NAME=group-by-country-sum
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=master.country-sum.input
    image: group_by_country_sum:latest
    networks: &id018
      - movies_net
  group-by-country-sum-2:
    build: *id016
    container_name: group-by-country-sum-2
    depends_on: *id017
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.groupby.country-sum.input
      - CLI_WORKER_QUEUE_NAME=group-by-country-sum
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=master.country-sum.input
    image: group_by_country_sum:latest
    networks: *id018
  group-by-country-sum-3:
    build: *id016
    container_name: group-by-country-sum-3
    depends_on: *id017
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.groupby.country-sum.input
      - CLI_WORKER_QUEUE_NAME=group-by-country-sum
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=master.country-sum.input
    image: group_by_country_sum:latest
    networks: *id018
  group-by-movie-average-1:
    build: &id019
      context: .
      dockerfile: group_by/group_by_movie_average/Dockerfile
    container_name: group-by-movie-average-1
    depends_on: &id020
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.movie-avg.input
      - CLI_WORKER_QUEUE_NAME=group-by-movie-average
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.movie-avg.output
    image: group_by_movie_average:latest
    networks: &id021
      - movies_net
  group-by-movie-average-2:
    build: *id019
    container_name: group-by-movie-average-2
    depends_on: *id020
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.movie-avg.input
      - CLI_WORKER_QUEUE_NAME=group-by-movie-average
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.movie-avg.output
    image: group_by_movie_average:latest
    networks: *id021
  group-by-movie-average-3:
    build: *id019
    container_name: group-by-movie-average-3
    depends_on: *id020
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.movie-avg.input
      - CLI_WORKER_QUEUE_NAME=group-by-movie-average
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.movie-avg.output
    image: group_by_movie_average:latest
    networks: *id021
  group-by-overview-average-1:
    build: &id022
      context: .
      dockerfile: group_by/group_by_overview_average/Dockerfile
    container_name: group-by-overview-average-1
    depends_on: &id023
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.overview.input
      - CLI_WORKER_QUEUE_NAME=group-by-overview-average
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.overview.output
    image: group_by_overview_average:latest
    networks: &id024
      - movies_net
  group-by-overview-average-2:
    build: *id022
    container_name: group-by-overview-average-2
    depends_on: *id023
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.overview.input
      - CLI_WORKER_QUEUE_NAME=group-by-overview-average
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.overview.output
    image: group_by_overview_average:latest
    networks: *id024
  group-by-overview-average-3:
    build: *id022
    container_name: group-by-overview-average-3
    depends_on: *id023
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.overview.input
      - CLI_WORKER_QUEUE_NAME=group-by-overview-average
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.overview.output
    image: group_by_overview_average:latest
    networks: *id024
  join-movie-credits-1:
    build: &id025
      context: .
      dockerfile: joins/join_movie_credits/Dockerfile
    container_name: join-movie-credits-1
    depends_on: &id026
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=join.movies.input
      - CLI_WORKER_QUEUE_NAME=join-movie-credits
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.actor.input
      - CLI_WORKER_EXCHANGE_SECONDINPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_SECONDINPUT_ROUTINGKEYS=credits.input1
      - CLI_WORKER_SECONDQUEUE_NAME=join-movie-credits
      - CLI_WORKER_EXPECTEDEOF2=1
    image: join_movie_credits:latest
    networks: &id027
      - movies_net
  join-movie-credits-2:
    build: *id025
    container_name: join-movie-credits-2
    depends_on: *id026
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=join.movies.input
      - CLI_WORKER_QUEUE_NAME=join-movie-credits
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.actor.input
      - CLI_WORKER_EXCHANGE_SECONDINPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_SECONDINPUT_ROUTINGKEYS=credits.input2
      - CLI_WORKER_SECONDQUEUE_NAME=join-movie-credits
      - CLI_WORKER_EXPECTEDEOF2=1
    image: join_movie_credits:latest
    networks: *id027
  join-movie-credits-3:
    build: *id025
    container_name: join-movie-credits-3
    depends_on: *id026
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=join.movies.input
      - CLI_WORKER_QUEUE_NAME=join-movie-credits
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.actor.input
      - CLI_WORKER_EXCHANGE_SECONDINPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_SECONDINPUT_ROUTINGKEYS=credits.input3
      - CLI_WORKER_SECONDQUEUE_NAME=join-movie-credits
      - CLI_WORKER_EXPECTEDEOF2=1
    image: join_movie_credits:latest
    networks: *id027
  join-movie-ratings-1:
    build: &id028
      context: .
      dockerfile: joins/join_movie_ratings/Dockerfile
    container_name: join-movie-ratings-1
    depends_on: &id029
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=join.movies.input
      - CLI_WORKER_QUEUE_NAME=join-movie-ratings
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.movie-avg.input
      - CLI_WORKER_EXCHANGE_SECONDINPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_SECONDINPUT_ROUTINGKEYS=ratings.input1
      - CLI_WORKER_SECONDQUEUE_NAME=join-movie-ratings
      - CLI_WORKER_EXPECTEDEOF2=1
    image: join_movie_ratings:latest
    networks: &id030
      - movies_net
  join-movie-ratings-2:
    build: *id028
    container_name: join-movie-ratings-2
    depends_on: *id029
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=join.movies.input
      - CLI_WORKER_QUEUE_NAME=join-movie-ratings
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.movie-avg.input
      - CLI_WORKER_EXCHANGE_SECONDINPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_SECONDINPUT_ROUTINGKEYS=ratings.input2
      - CLI_WORKER_SECONDQUEUE_NAME=join-movie-ratings
      - CLI_WORKER_EXPECTEDEOF2=1
    image: join_movie_ratings:latest
    networks: *id030
  join-movie-ratings-3:
    build: *id028
    container_name: join-movie-ratings-3
    depends_on: *id029
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=join.movies.input
      - CLI_WORKER_QUEUE_NAME=join-movie-ratings
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.movie-avg.input
      - CLI_WORKER_EXCHANGE_SECONDINPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_SECONDINPUT_ROUTINGKEYS=ratings.input3
      - CLI_WORKER_SECONDQUEUE_NAME=join-movie-ratings
      - CLI_WORKER_EXPECTEDEOF2=1
    image: join_movie_ratings:latest
    networks: *id030
  machine-learning-1:
    build: &id031
      context: .
      dockerfile: machine_learning/Dockerfile
    container_name: machine-learning-1
    cpus: "2"
    depends_on: &id032
      - rabbitmq
    entrypoint: python main.py
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.input1,movies.input2,movies.input3
      - CLI_WORKER_QUEUE_NAME=machine-learning
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.overview.input
    image: machine_learning:latest
    networks: &id033
      - movies_net
  machine-learning-2:
    build: *id031
    container_name: machine-learning-2
    cpus: "2"
    depends_on: *id032
    entrypoint: python main.py
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.input1,movies.input2,movies.input3
      - CLI_WORKER_QUEUE_NAME=machine-learning
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.overview.input
    image: machine_learning:latest
    networks: *id033
  machine-learning-3:
    build: *id031
    container_name: machine-learning-3
    cpus: "2"
    depends_on: *id032
    entrypoint: python main.py
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=movies.input1,movies.input2,movies.input3
      - CLI_WORKER_QUEUE_NAME=machine-learning
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=groupby.overview.input
    image: machine_learning:latest
    networks: *id033
  master-group-by-actor-count-1:
    build:
      context: .
      dockerfile: master_group_by/master_group_by_actor_count/Dockerfile
    container_name: master-group-by-actor-count-1
    depends_on:
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.actor.output
      - CLI_WORKER_QUEUE_NAME=master-group-by-actor-count
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=topn.top-10-cast.input
    image: master_group_by_actor_count:latest
    networks:
      - movies_net
  master-group-by-country-sum-1:
    build:
      context: .
      dockerfile: master_group_by/master_group_by_country_sum/Dockerfile
    container_name: master-group-by-country-sum-1
    depends_on:
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=master.country-sum.input
      - CLI_WORKER_QUEUE_NAME=master-group-by-country-sum
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=master.country-sum.output
    image: master_group_by_country_sum:latest
    networks:
      - movies_net
  master-group-by-movie-average-1:
    build:
      context: .
      dockerfile: master_group_by/master_group_by_movie_average/Dockerfile
    container_name: master-group-by-movie-average-1
    depends_on:
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.movie-avg.output
      - CLI_WORKER_QUEUE_NAME=master-group-by-movie-average
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=topn.first-last.input
    image: master_group_by_movie_average:latest
    networks:
      - movies_net
  master-group-by-overview-average-1:
    build:
      context: .
      dockerfile: master_group_by/master_group_by_overview_average/Dockerfile
    container_name: master-group-by-overview-average-1
    depends_on:
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=groupby.overview.output
      - CLI_WORKER_QUEUE_NAME=master-group-by-overview-average
      - CLI_WORKER_EXPECTEDEOF=3
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=query5.results
    image: master_group_by_overview_average:latest
    networks:
      - movies_net
  rabbitmq:
    container_name: rabbitmq
    image: rabbitmq:management
    logging:
      driver: none
    networks:
      - movies_net
    ports:
      - 5672:5672
      - 15672:15672
  top-five-country-budget-1:
    build:
      context: .
      dockerfile: topn/top_five_country_budget/Dockerfile
    container_name: top-five-country-budget-1
    depends_on:
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=master.country-sum.output
      - CLI_WORKER_QUEUE_NAME=top-five-country-budget
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=query2.results
    image: top_five_country_budget:latest
    networks:
      - movies_net
  top-ten-cast-movie-1:
    build:
      context: .
      dockerfile: topn/top_ten_cast_movie/Dockerfile
    container_name: top-ten-cast-movie-1
    depends_on:
      - rabbitmq
    entrypoint: ./run_worker
    environment:
      - CLI_WORKER_BROKER=amqp://guest:guest@rabbitmq:5672/
      - CLI_LOG_LEVEL=debug
      - CLI_WORKER_EXCHANGE_OUTPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_NAME=data_exchange
      - CLI_WORKER_EXCHANGE_INPUT_ROUTINGKEYS=topn.top-10-cast.input
      - CLI_WORKER_QUEUE_NAME=top-ten-cast-movie
      - CLI_WORKER_EXPECTEDEOF=1
      - CLI_WORKER_EXCHANGE_OUTPUT_ROUTINGKEYS=query4.results
    image: top_ten_cast_movie:latest
    networks:
      - movies_net
